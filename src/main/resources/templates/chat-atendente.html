<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<div th:replace="fragments/head :: head('MedSau - Dashboard')"></div>

<body style="background-color: #F8F9FAFF; overflow: hidden;">

<div class="wrapper ">

    <div class="sidebar" data-color="white" data-active-color="danger">
        <div class="logo" style="margin-bottom: 10px">
            <a style="margin-left: 10px" class="simple-text logo-normal">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-list-ol" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/>
                    <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/>
                </svg>
                &nbsp;
                Fila de espera
            </a>
        </div>
        <div class="sidebar-wrapper" style="overflow-x: hidden;">
            <ul class="nav" id="filaDeEspera">

            </ul>
        </div>
    </div>


    <div class="main-panel" style="background-color: #F8F9FAFF;">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
            <div class="container-fluid">
<!--                <div class="navbar-wrapper">-->
<!--                    <a class="navbar-brand">Ocorrência</a>-->
<!--                </div>-->
                <div class="collapse navbar-collapse justify-content-end" id="navigation">

                    <div class="nav-item btn-rotate dropdown">

                        <a class="nav-link" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                            </svg>
                        </a>

                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                            <div class="dropdown-item" style="height: 46px;">
                                <div style="margin-top: 4px">
                                    <label class="switch">
                                        <input type="checkbox" th:onclick="'ativar()'" th:checked="${sistemaForaDoAr}">
                                        <span class="slider round"></span>
                                    </label>
                                    &nbsp;
                                    Fora do ar
                                </div>
                            </div>

                            <a style="height: 46px" class="dropdown-item text-center" th:href="@{/logout}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                                    <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                                </svg>
                                &nbsp;
                                &nbsp;
                                &nbsp;
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- End Navbar -->
        <div class="content">

            <div class="row">
                <div class="col-md-1 pl-1">

                </div>
                <div class="col-md-10 pl-1">

                    <nav class="navbar navbar-expand-lg" style="margin-bottom: 0px; border-bottom: 2px solid #E3E3E3;background-color: white">
                        <div class="container-fluid">
                            <div class="navbar-wrapper">
                                <a class="navbar-brand" style="color: black">Claudia da silva</a>
                            </div>
                            <div class="collapse navbar-collapse justify-content-end">

                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red" class="bi bi-x-square-fill" viewBox="0 0 16 16">
                                    <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z"/>
                                </svg>
                            </div>
                        </div>
                    </nav>

                    <div class="card" style="border-radius: 3px; height: 750px; margin-top: 0px; overflow-x: hidden">
                        <div class="card-body" >
                            <ul class="list-group list-group-flush">

                            </ul>
                        </div>
                    </div>

                    <div class="input-group mb-3">
                        <input style="height: 40px" type="text" class="form-control" placeholder="Escreva aqui" aria-describedby="basic-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-primary" style="height: 40px; margin-top: 0px" type="button">Enviar</button>
                        </div>
                    </div>
                </div>

                <div class="col-md-1 pl-1">

                </div>
            </div>



        </div>


    </div>
</div>

<div th:replace="fragments/imports :: imports"></div>

<script>
    const baseurl = window.location.origin;

    function ativar(){
        $.ajax({
            url : baseurl+"/atendente/sistemaForaDoAr",
            type : 'get',

            success: function (response){
                window.location.reload();
            },

            error: function (xhr, textStatus, error){
                console.log(xhr)
                Swal.fire({
                    icon: 'error',
                    title: 'Ooops...',
                    text: 'Houve um problema interno ao informar que o sistema está fora do ar',
                })
            }
        })
    }

    function creatElementeFilaDeEspera(paciente){
        let li = document.createElement("li");
        let a = document.createElement("a");
        let svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
        let path = document.createElementNS('http://www.w3.org/2000/svg','path');
        let hr = document.createElement("hr");

        a.style = "margin-top: 0px";

        svg.setAttribute('width',20);
        svg.setAttribute('height',20);
        svg.setAttribute('fill', '#51cbce');
        svg.setAttribute('viewBox', '0 0 16 16');
        svg.className = 'bi bi-chat-square-text-fill';
        svg.style = "margin-right: 10px";

        path.setAttribute(
            'd',
            'M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0 0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1 1 0 0 0-.8-.4H2a2 2 0 0 1-2-2V2zm3.5 1a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5z'
        );

        svg.appendChild(path);

        hr.style = "margin-bottom: 0px";

        a.appendChild(svg);
        a.appendChild(document.createTextNode(paciente.nome));
        a.appendChild(hr);

        li.appendChild(a);

        return li;
    }

    function getFilaDeEspera(){
        let filaUl = document.getElementsByTagName("ul")[0];
        let filaArray = Array.from(filaUl.children);

        $.ajax({
            type: "GET",
            url : baseurl+"/getFila",
            dataType: 'json',
            success: function(data) {
                for(let i = filaArray.length; i < data.length; ++i){
                    filaUl.appendChild(creatElementeFilaDeEspera(data[i].paciente));
                }
            },

            error: function (xhr, textStatus, error){
                console.log(error);
            }
        });
    }

    setInterval(getFilaDeEspera, 3000);

    function createElementeChat(mensagem){
        let li = document.createElement("li");
        let div = document.createElement("div");
        let strong = document.createElement("strong");
        let p = document.createElement("p");

        li.className = "list-group-item";

        div.style = "margin-bottom: 6px";

        strong.className = "primary-font";
        strong.appendChild(document.createTextNode(mensagem.remetente))

        div.appendChild(strong);

        strong = document.createElement("strong");
        strong.className = "pull-right text-muted";
        strong.appendChild(document.createTextNode(mensagem.data))

        div.appendChild(strong);

        li.appendChild(div);

        p.className = "mb-0";
        p.style = "margin-bottom: 3px";
        p.appendChild(document.createTextNode(mensagem.conteudo));

        li.appendChild(p);
    }

    function getChat(){
        let chatUl = document.getElementsByTagName("ul")[1];
        let chatArray = Array.from(chatUl.children);

        $.ajax({
            type: "GET",
            url : baseurl+"/getChat",
            dataType: 'json',
            success: function(data) {
                for(let i = chatArray.length; i < data.length; ++i){
                    chatUl.appendChild(createElementeChat(data[i]));
                    chatUl.scrollIntoView(false);
                }
            },

            error: function (xhr, textStatus, error){
                console.log(error);
            }
        });
    }

    setInterval(getChat, 1000);

</script>

</body>
</html>